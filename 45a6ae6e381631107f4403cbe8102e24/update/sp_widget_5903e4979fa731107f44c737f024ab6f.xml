<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function ($scope, spUtil) {
	/* widget controller */
	var c = this;
	c.data.roles = c.data.userInfo.roles;
	$scope.$on("field.change", function (evt, params) {
		c.data.roles = {
			displayValue: params.displayValue,
			value: params.newValue
		};
	});

	c.updateRequest = function(){
		c.data.action = "updateInfo";
		c.server.update().then(handleSuccess,handleError);
	};

	function deleteProp(obj, key) {
		if (obj.hasOwnProperty(key)) {
			delete obj[key];
		}
		return obj;
	}

	// Reset data properties
	function resetData() {
		deleteProp(c.data,"action");
		c.server.refresh();
	}

	function handleSuccess(res) {
		resetData();
	}

	function handleError(error) {
		// Handle or log the error as needed
		console.error('An error occurred:', error);
		resetData();
	}



};]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>tsp_admin_user_info</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>Admin - User Info</name>
        <option_schema/>
        <public>false</public>
        <roles>x_snc_accessprov_0.admin</roles>
        <script><![CDATA[(function () {
	/* populate the 'data' object */
	data.userInfo = new APCommonFunctions().getReqRecord(gs.action.getGlideURI().get('sys_id'));
})();

(function() {
	if(input){
		if(input.action == "updateInfo"){
			var data = {
				firstName: input.userInfo.firstName,
				lastName: input.userInfo.lastName,
				mailID : input.userInfo.mailID,
				userID: input.userInfo.userID,
				roles: input.roles.value
			};
			var res = new APCommonFunctions().updateUserInfo(gs.action.getGlideURI().get('sys_id'),data);
			if(res.isUpdated)
				gs.addInfoMessage("Updated Successfully")
			else
				gs.addErrorMessage("Unable to update the requested info. Reason "+res.msg);
		}
	}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-01-10 12:50:14</sys_created_on>
        <sys_id>5903e4979fa731107f44c737f024ab6f</sys_id>
        <sys_name>Admin - User Info</sys_name>
        <sys_package display_value="AccessProvider" source="x_snc_accessprov_0">45a6ae6e381631107f4403cbe8102e24</sys_package>
        <sys_policy/>
        <sys_scope display_value="AccessProvider">45a6ae6e381631107f4403cbe8102e24</sys_scope>
        <sys_update_name>sp_widget_5903e4979fa731107f44c737f024ab6f</sys_update_name>
        <template><![CDATA[<div>
  <form class="form-horizontal">
    <fieldset>

      <!-- Form Name -->
      <legend class="text-center">
        <h3>User Info</h3>
      </legend>

      <!-- MUID/XUID -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_uid">MUID / XUID </label>
        <div class="col-md-6">
          <input id="txt_uid" ng-model="data.userInfo.uID" type="text" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- First Name -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_first_name">First Name</label>
        <div class="col-md-6">
          <input id="txt_first_name" ng-model="data.userInfo.firstName" type="text" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- Last Name -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_last_name">Last Name</label>
        <div class="col-md-6">
          <input id="txt_last_name" ng-model="data.userInfo.lastName" type="text" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- Email ID -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_email">Email Id</label>
        <div class="col-md-6">
          <input id="txt_email" ng-model="data.userInfo.mailID" type="email" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- Automation -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_automation">Automation</label>
        <div class="col-md-6">
          <input id="txt_email" ng-model="data.userInfo.automationName" type="text" class="form-control input-md" disabled>
      </div>
      </div>

      <!-- Environment -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_env">Environment</label>
        <div class="col-md-6">
          <input id="txt_email" ng-model="data.userInfo.environment" type="text" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- Roles -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_roles">Roles</label>
        <div class="col-md-6">
          <sn-record-picker id="txt_roles" table="data.userInfo.rolesTable" field="data.roles" display-field="'name'" value-field="'sys_id'" search-fields="'name'" page-size="100" multiple="true"></sn-record-picker>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-group">
        <div class="col-md-6">
          <button id="btn_submit" name="btn_submit" class="btn btn-primary" ng-click="c.updateRequest()"
            type="submit">Submit</button>
        </div>
      </div>

    </fieldset>
  </form>

</div>]]></template>
    </sp_widget>
</record_update>
