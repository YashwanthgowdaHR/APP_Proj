<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function() {
  /* widget controller */
  var c = this;
	c.requestAccess = function(){
		c.server.update();
	}

};]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>aam_access_request_widget</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>Access Request</name>
        <option_schema/>
        <public>false</public>
        <roles>x_1131046_aa_man_0.user</roles>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	var gr = new GlideRecord('sys_user');
	gr.addQuery('user_name', gs.getUserName());
	gr.query();
	if(gr.next()){
		data.firstName = gr.getValue('first_name');
		data.lastName = gr.getValue('last_name');
		data.userName = gr.getValue('user_name');
		data.mailID = gr.getValue('email');
	}
	
	gr = new GlideRecord('x_1131046_aa_man_0_users');
	data.env = gr.getElement('environment').getChoices();

	if(input){
		if(input.firstName !="" && input.lastName !="" && input.userName !="" && input.mailID !="" && input.tempEnv !=""){
			gr = new GlideRecord('x_1131046_aa_man_0_users');
			gr.addQuery('first_name', input.firstName);
			gr.addQuery('last_name', input.lastName);
			gr.addQuery('username', input.userName);
			gr.addQuery('mail_id', input.mailID);
			gr.addQuery('environment', input.tempEnv);
			gr.query();
			if(!gr.hasNext()){
				var role = "";
				var license = "";
				var grRole = new GlideRecord('x_1131046_aa_man_0_roles');
				var grLicense = new GlideRecord('x_1131046_aa_man_0_licenses');
				if(input.tempEnv == "DEV"){
					grRole.addQuery('name', 'AA_DEV_Others');
					grRole.query();
					if(grRole.next())
						role = grRole.getUniqueValue();
					
					grLicense.addQuery('name', 'Development');
					grLicense.query();
					if(grLicense.next())
						license = grLicense.getUniqueValue();
				}
				else{
					grRole.addQuery('name', 'AA_Runner_Test');
					grRole.query();
					if(grRole.next())
						role = grRole.getUniqueValue();
					
					grLicense.addQuery('name', 'Runtime');
					grLicense.query();
					if(grLicense.next())
						license = grLicense.getUniqueValue();
				}
				
				gr.initialize();
				gr.setValue('first_name', input.firstName);
				gr.setValue('last_name', input.lastName);
				gr.setValue('username', input.userName);
				gr.setValue('mail_id', input.mailID);
				gr.setValue('environment', input.tempEnv);
				gr.setValue('roles', role);
				gr.setValue('licenses', license);
				gr.insert();
				//isInserted = True | false, msg
				gs.addInfoMessage('Request submitted successfully');
			}else{
				gs.addErrorMessage('Request exists already!');
			}
			
		}else{
			gs.addErrorMessage("Check fields again");
		}
	}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-02-09 09:05:25</sys_created_on>
        <sys_id>a7cec2789350021030ae7c5efaba10f6</sys_id>
        <sys_mod_count>35</sys_mod_count>
        <sys_name>Access Request</sys_name>
        <sys_package display_value="AA Management" source="x_1131046_aa_man_0">7630a7f79340021030ae7c5efaba105f</sys_package>
        <sys_policy/>
        <sys_scope display_value="AA Management">7630a7f79340021030ae7c5efaba105f</sys_scope>
        <sys_update_name>sp_widget_a7cec2789350021030ae7c5efaba10f6</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-02-09 11:48:47</sys_updated_on>
        <template><![CDATA[<div>
  <form class="form-horizontal">
    <fieldset>
      <!-- Form Name -->
       <h3 class="text-center">Raise Request</h3>

      <!-- MUID/XUID -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_uid">Username / UID</label>
        <div class="col-md-6">
          <input id="txt_uid" ng-model="c.data.userName" type="text" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- First Name -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_first_name">First Name</label>
        <div class="col-md-6">
          <input id="txt_first_name" ng-model="c.data.firstName" type="text" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- Last Name -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_last_name">Last Name</label>
        <div class="col-md-6">
          <input id="txt_last_name" ng-model="c.data.lastName" type="text" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- Email ID -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_email">Email Id</label>
        <div class="col-md-6">
          <input id="txt_email" ng-model="c.data.mailID" type="email" class="form-control input-md" disabled>
        </div>
      </div>

      <!-- Environment -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="txt_env">Environment</label>
        <div class="col-md-6">
          <select id="txt_env" class="form-control input-md" ng-model="c.data.tempEnv"
            ng-init="c.data.tempEnv = data.env[0]" ng-options="option for option in c.data.env">
          </select>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-group">
        <div class="col-md-6">
          <button id="btn_submit" name="btn_submit" class="btn btn-primary" ng-click="c.requestAccess()"
            type="submit">Submit</button>
        </div>
      </div>

    </fieldset>
  </form>

</div>]]></template>
    </sp_widget>
</record_update>
